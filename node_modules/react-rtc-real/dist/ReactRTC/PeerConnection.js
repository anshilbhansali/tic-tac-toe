"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _react = _interopRequireWildcard(require("react"));

var _utils = require("./functions/utils");

var _constants = require("./functions/constants");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var PeerConnection =
/*#__PURE__*/
function (_Component) {
  _inherits(PeerConnection, _Component);

  function PeerConnection(props) {
    var _this;

    _classCallCheck(this, PeerConnection);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(PeerConnection).call(this, props));

    _defineProperty(_assertThisInitialized(_this), "addMediaStreamTrack",
    /*#__PURE__*/
    _asyncToGenerator(
    /*#__PURE__*/
    regeneratorRuntime.mark(function _callee() {
      var _this$props, localMediaStream, rtcPeerConnection;

      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _this$props = _this.props, localMediaStream = _this$props.localMediaStream, rtcPeerConnection = _this$props.rtcPeerConnection;
              console.log('addMediaStream: ', localMediaStream);

              if (!localMediaStream) {
                _context.next = 5;
                break;
              }

              _context.next = 5;
              return localMediaStream.getTracks().forEach(function (mediaStreamTrack) {
                rtcPeerConnection.addTrack(mediaStreamTrack);
              });

            case 5:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    })));

    _defineProperty(_assertThisInitialized(_this), "handleOnNegotiationNeeded",
    /*#__PURE__*/
    function () {
      var _ref2 = _asyncToGenerator(
      /*#__PURE__*/
      regeneratorRuntime.mark(function _callee2(negotiationNeededEvent) {
        var _this$props2, sendMessage, roomInfo, rtcPeerConnection, offer, payload, offerMessage;

        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _this$props2 = _this.props, sendMessage = _this$props2.sendMessage, roomInfo = _this$props2.roomInfo, rtcPeerConnection = _this$props2.rtcPeerConnection;
                _context2.prev = 1;
                _context2.next = 4;
                return rtcPeerConnection.createOffer();

              case 4:
                offer = _context2.sent;
                _context2.next = 7;
                return rtcPeerConnection.setLocalDescription(offer);

              case 7:
                payload = (0, _utils.createPayload)(roomInfo.roomKey, roomInfo.socketID, rtcPeerConnection.localDescription);
                offerMessage = (0, _utils.createMessage)(_constants.TYPE_OFFER, payload);
                sendMessage(JSON.stringify(offerMessage));
                _context2.next = 15;
                break;

              case 12:
                _context2.prev = 12;
                _context2.t0 = _context2["catch"](1);
                console.error('handleNegotiationNeeded Error: ', _context2.t0);

              case 15:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, null, [[1, 12]]);
      }));

      return function (_x) {
        return _ref2.apply(this, arguments);
      };
    }());

    _defineProperty(_assertThisInitialized(_this), "handleOnIceEvent", function (rtcPeerConnectionIceEvent) {
      if (rtcPeerConnectionIceEvent.candidate) {
        var _this$props3 = _this.props,
            sendMessage = _this$props3.sendMessage,
            roomInfo = _this$props3.roomInfo;
        var candidate = rtcPeerConnectionIceEvent.candidate;
        var payload = (0, _utils.createPayload)(roomInfo.roomKey, roomInfo.socketID, JSON.stringify(candidate));
        var iceCandidateMessage = (0, _utils.createMessage)(_constants.TYPE_ICECANDIDATE, payload);
        sendMessage(JSON.stringify(iceCandidateMessage));
      }
    });

    _defineProperty(_assertThisInitialized(_this), "handleOnTrack", function (trackEvent) {
      var remoteMediaStream = new MediaStream([trackEvent.track]);

      _this.props.addRemoteStream(remoteMediaStream);
    });

    return _this;
  }

  _createClass(PeerConnection, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      var rtcPeerConnection = this.props.rtcPeerConnection;
      rtcPeerConnection.onnegotiationneeded = this.handleOnNegotiationNeeded;
      rtcPeerConnection.onicecandidate = this.handleOnIceEvent;
      rtcPeerConnection.ontrack = this.handleOnTrack;
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      if (this.props.startConnection !== prevProps.startConnection) {
        this.addMediaStreamTrack();
      }
    }
  }, {
    key: "render",
    value: function render() {
      return _react["default"].createElement(_react["default"].Fragment, null);
    }
  }]);

  return PeerConnection;
}(_react.Component);

var _default = PeerConnection;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9SZWFjdFJUQy9QZWVyQ29ubmVjdGlvbi5qc3giXSwibmFtZXMiOlsiUGVlckNvbm5lY3Rpb24iLCJwcm9wcyIsImxvY2FsTWVkaWFTdHJlYW0iLCJydGNQZWVyQ29ubmVjdGlvbiIsImNvbnNvbGUiLCJsb2ciLCJnZXRUcmFja3MiLCJmb3JFYWNoIiwibWVkaWFTdHJlYW1UcmFjayIsImFkZFRyYWNrIiwibmVnb3RpYXRpb25OZWVkZWRFdmVudCIsInNlbmRNZXNzYWdlIiwicm9vbUluZm8iLCJjcmVhdGVPZmZlciIsIm9mZmVyIiwic2V0TG9jYWxEZXNjcmlwdGlvbiIsInBheWxvYWQiLCJyb29tS2V5Iiwic29ja2V0SUQiLCJsb2NhbERlc2NyaXB0aW9uIiwib2ZmZXJNZXNzYWdlIiwiVFlQRV9PRkZFUiIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvciIsInJ0Y1BlZXJDb25uZWN0aW9uSWNlRXZlbnQiLCJjYW5kaWRhdGUiLCJpY2VDYW5kaWRhdGVNZXNzYWdlIiwiVFlQRV9JQ0VDQU5ESURBVEUiLCJ0cmFja0V2ZW50IiwicmVtb3RlTWVkaWFTdHJlYW0iLCJNZWRpYVN0cmVhbSIsInRyYWNrIiwiYWRkUmVtb3RlU3RyZWFtIiwib25uZWdvdGlhdGlvbm5lZWRlZCIsImhhbmRsZU9uTmVnb3RpYXRpb25OZWVkZWQiLCJvbmljZWNhbmRpZGF0ZSIsImhhbmRsZU9uSWNlRXZlbnQiLCJvbnRyYWNrIiwiaGFuZGxlT25UcmFjayIsInByZXZQcm9wcyIsInN0YXJ0Q29ubmVjdGlvbiIsImFkZE1lZGlhU3RyZWFtVHJhY2siLCJDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBRU1BLGM7Ozs7O0FBQ0osMEJBQVlDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTs7QUFDakIsd0ZBQU1BLEtBQU47O0FBRGlCO0FBQUE7QUFBQTtBQUFBO0FBQUEsNEJBSUc7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QUFtQyxLQUFLQyxnQkFBeEM7QUFDQWxDLE1BQUFBLGlCQUFpQixDQUFDbUMsT0FBbEIsR0FBNEIsS0FBS0MsYUFBakM7QUFDRDs7O3VDQUVrQkMsUyxFQUFXO0FBQzVCLFVBQUksS0FBS3ZDLEtBQUwsQ0FBV3dDLGVBQVgsS0FBK0JELFNBQVMsQ0FBQ0MsZUFBN0MsRUFBOEQ7QUFDNUQsYUFBS0MsbUJBQUw7QUFDRDtBQUNGOzs7NkJBRVE7QUFDUCxhQUNFLGlFQURGO0FBSUQ7Ozs7RUE3RDBCQyxnQjs7ZUFnRWQzQyxjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IGNyZWF0ZU1lc3NhZ2UsIGNyZWF0ZVBheWxvYWQgfSBmcm9tICcuL2Z1bmN0aW9ucy91dGlscyc7XG5pbXBvcnQgeyBUWVBFX09GRkVSLCBUWVBFX0lDRUNBTkRJREFURSB9IGZyb20gJy4vZnVuY3Rpb25zL2NvbnN0YW50cyc7XG5cbmNsYXNzIFBlZXJDb25uZWN0aW9uIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcylcbiAgfVxuXG4gIGFkZE1lZGlhU3RyZWFtVHJhY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgeyBsb2NhbE1lZGlhU3RyZWFtLCBydGNQZWVyQ29ubmVjdGlvbiB9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnNvbGUubG9nKCdhZGRNZWRpYVN0cmVhbTogJywgbG9jYWxNZWRpYVN0cmVhbSk7XG4gICAgaWYgKGxvY2FsTWVkaWFTdHJlYW0pIHtcbiAgICAgIGF3YWl0IGxvY2FsTWVkaWFTdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaCgobWVkaWFTdHJlYW1UcmFjaykgPT4ge1xuICAgICAgICBydGNQZWVyQ29ubmVjdGlvbi5hZGRUcmFjayhtZWRpYVN0cmVhbVRyYWNrKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZU9uTmVnb3RpYXRpb25OZWVkZWQgPSBhc3luYyAobmVnb3RpYXRpb25OZWVkZWRFdmVudCkgPT4ge1xuICAgIGNvbnN0IHsgc2VuZE1lc3NhZ2UsIHJvb21JbmZvLCBydGNQZWVyQ29ubmVjdGlvbiB9ID0gdGhpcy5wcm9wcztcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb2ZmZXIgPSBhd2FpdCBydGNQZWVyQ29ubmVjdGlvbi5jcmVhdGVPZmZlcigpO1xuICAgICAgYXdhaXQgcnRjUGVlckNvbm5lY3Rpb24uc2V0TG9jYWxEZXNjcmlwdGlvbihvZmZlcik7XG4gICAgICBjb25zdCBwYXlsb2FkID0gY3JlYXRlUGF5bG9hZChyb29tSW5mby5yb29tS2V5LCByb29tSW5mby5zb2NrZXRJRCwgcnRjUGVlckNvbm5lY3Rpb24ubG9jYWxEZXNjcmlwdGlvbik7XG4gICAgICBjb25zdCBvZmZlck1lc3NhZ2UgPSBjcmVhdGVNZXNzYWdlKFRZUEVfT0ZGRVIsIHBheWxvYWQpO1xuICAgICAgc2VuZE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkob2ZmZXJNZXNzYWdlKSk7XG4gICAgfSBjYXRjaChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignaGFuZGxlTmVnb3RpYXRpb25OZWVkZWQgRXJyb3I6ICcsIGVycm9yKVxuICAgIH1cbiAgfVxuXG4gIGhhbmRsZU9uSWNlRXZlbnQgPSAocnRjUGVlckNvbm5lY3Rpb25JY2VFdmVudCkgPT4ge1xuICAgIGlmIChydGNQZWVyQ29ubmVjdGlvbkljZUV2ZW50LmNhbmRpZGF0ZSkge1xuICAgICAgY29uc3QgeyBzZW5kTWVzc2FnZSwgcm9vbUluZm8gfSA9IHRoaXMucHJvcHM7XG4gICAgICBjb25zdCB7IGNhbmRpZGF0ZSB9ID0gcnRjUGVlckNvbm5lY3Rpb25JY2VFdmVudDtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSBjcmVhdGVQYXlsb2FkKHJvb21JbmZvLnJvb21LZXksIHJvb21JbmZvLnNvY2tldElELCBKU09OLnN0cmluZ2lmeShjYW5kaWRhdGUpKTtcbiAgICAgIGNvbnN0IGljZUNhbmRpZGF0ZU1lc3NhZ2UgPSBjcmVhdGVNZXNzYWdlKFRZUEVfSUNFQ0FORElEQVRFLCBwYXlsb2FkKTtcbiAgICAgIHNlbmRNZXNzYWdlKEpTT04uc3RyaW5naWZ5KGljZUNhbmRpZGF0ZU1lc3NhZ2UpKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVPblRyYWNrID0gKHRyYWNrRXZlbnQpID0+IHtcbiAgICBjb25zdCByZW1vdGVNZWRpYVN0cmVhbSA9IG5ldyBNZWRpYVN0cmVhbShbIHRyYWNrRXZlbnQudHJhY2sgXSk7XG4gICAgdGhpcy5wcm9wcy5hZGRSZW1vdGVTdHJlYW0ocmVtb3RlTWVkaWFTdHJlYW0pO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgY29uc3QgeyBydGNQZWVyQ29ubmVjdGlvbiB9ID0gdGhpcy5wcm9wcztcbiAgICBydGNQZWVyQ29ubmVjdGlvbi5vbm5lZ290aWF0aW9ubmVlZGVkID0gdGhpcy5oYW5kbGVPbk5lZ290aWF0aW9uTmVlZGVkO1xuICAgIHJ0Y1BlZXJDb25uZWN0aW9uLm9uaWNlY2FuZGlkYXRlID0gdGhpcy5oYW5kbGVPbkljZUV2ZW50O1xuICAgIHJ0Y1BlZXJDb25uZWN0aW9uLm9udHJhY2sgPSB0aGlzLmhhbmRsZU9uVHJhY2s7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuc3RhcnRDb25uZWN0aW9uICE9PSBwcmV2UHJvcHMuc3RhcnRDb25uZWN0aW9uKSB7XG4gICAgICB0aGlzLmFkZE1lZGlhU3RyZWFtVHJhY2soKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuKFxuICAgICAgPD5cbiAgICAgIDwvPlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGVlckNvbm5lY3Rpb247XG4iXX0=